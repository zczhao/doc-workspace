# vim 编辑器

## 一、vi 编辑器简介

vim 是一个全屏幕纯文本编辑器，是vi编辑器的增强版，主要讲解的是vim编辑器。可以利用别名输入vi命令的时候，实际上执行vim编辑器，例如：

```shell
# 定义别名
[root@localhost ~]# alias vi='vim'
```

这样定义的别名是临时生效，如果需要永久生效，请放入环境变量配置文件(~/.bashrc)

## 二、vim 基本使用

### 1、vim 的工作模式

#### 1.1、普通(normal)模式

主要用来浏览和修改文件内容的，一般的，打开vim都是普通模式，只要按下Esc键就可以返回普通模式


#### 1.2、插入(insert)模式
**进入插入模式：**

| 命令 |         作用         |
| :--: | :------------------: |
|  a   | 在光标所在字符后插入 |
|  A   |   在光标所在行尾插   |
|  i   | 在光标所在字符前插入 |
|  I   | 在光标所在行行首插入 |
|  o   |   在光标下插入新行   |
|  O   |   在光标上插入新行   |
**输入模式：**主要用于文本编辑，和记事本类似，输入数据就好

```shell
Ctrl+h 删除上一个字符
Ctrl+w 删除上一个单词
Ctrl+u 删除当前行
```

#### 1.3、可视(Visual)模式

**可视(Visual)模式：**一般用来块状选择文本

​	Normal模式下使用v进入visual模式

| 命令   | 作用                             |
| ------ | -------------------------------- |
| v      | 进入visual选择                   |
| V      | 选择行                           |
| Ctrl+v | 进行方块选择                     |
| gv     | 选中前一次可视化模式时选择的文本 |

#### 1.4、命令(command)模式

**末行模式(编辑模式)：**

```shell
:w 保存不退出 
	:w 新文件名    #把文件另存为新文件
:q 不保存退出
:wq 保存退出
:x 保存退出
:! 强制
	:q! 强制不保存退出，用于修改文件后，不保存数据退出
	:wq! 强制保存退出，当文件的所有者或者root用户，对文件没有写权限的时候，强制写入数据使用
Shift+zz 退出
```



### 2、命令模式操作

#### 2.1、移动光标

##### 1、上下左右移动光标

```vim
上、下、左、右方向键		移动光标
H、j、k、l				 移动光标
```

##### 2、把光标移动到文件头或尾

```vim
gg		移动到文件头
G		移动到文件尾(Shift+g)
```

##### 3、移动到行首或行尾

```vim
^		移动到行首
$		移动到行尾
```

##### 4、移动到指定行

```shell
:n		移动到第几行(这里n是数字，准备移动到第几行，就用哪个数字)
```

##### 5、单词间移动

```shell
w/W 移动光标到下一个word/WORD开头
e/E 移动光标到下一个word/WORD结尾
b/B 移动梁村到上一个word/WORD开头
word指的是以非空白符分割的单词，WORD以空白符分割的单词
```

##### 6、行间搜索移动

同一行快速移动的方式其实是搜索一个字符并且移动到该字符

```shell
使用 f{chart} 可以移动到char字符上，t 移动到char的前一个字符
如果第一次没搜索到，可以用 分号(;) / 逗号(,) 继续搜该行下一个/上一个
大写的F表示反过来搜前面的字符
```

##### 7、水平移动

```shell
0 移动到行首每一个字符，^ 移动到第一个非空白字符
$ 移动到行尾，g_ 移动到行尾非空白字符
```

##### 8、垂值移动

还可以在句子(sendtence)和段落(paragraph)间移动(不常用)

```shell
使用括号 () 在句子间移动
使用 {} 在段落之间移动
```

##### 9、页面移动

```shell
gg/G 移动到文件开头和结尾，可以使用 Ctrl+o 快速返回
H/M/L 跳转到屏幕的开头(Head),中间(Middle)和结尾(Lower)
Ctrl+u/Ctrl+f 上下翻页(upword/forward)。zz把屏幕置为中间
```



#### 2.2、删除或剪切

##### 1、删除字母

```vim
x normal模式快速删除一个字符
nx 删除n个字母(n是数字，如果打算从光标位置删除连接的10个字母，可以使用"10x"即可。删除字母并不符合使用习惯，更习惯在编辑模式中，用"Backspace"键删除字母)
```

##### 2、删除整行

```vim
d  配合文本对象快速删除一个单词daw (d around word)
dd		删除单行
ndd		删除多行
:n1,n2d	删除指定范围的行(例：:5,10d 删除第5行到第10行)
```

删除整行或多行，这是比较常用的删除方法。这里的dd快捷键既是删除，也是剪切。删除内容放入了剪切板，如果不粘贴就是删除。粘贴方法如下：

```vim
p		粘贴到光标后
P(大写)  粘贴到光标前
```

##### 3、从光标所在行删除到文件尾

vim没有删除整篇文档的快捷键，但是可以这样：

```vim
dG		从光标所在行删除到文件尾
```

"d"是删除行，"G"是文件尾，连起来就是从光标所在行删除到文件尾。如果把光标入在文件首，那么”dG“就变成了删除整篇文档了

```shell
d 和 x 都可以搭配数字来执行多次

例子： 
diw 删除一个单词，保留单词后的空白字符
dw/daw 删除一个单词并包括单词后的空白字符
dt）删除当前光标到右括号前的字符
d$ 删除光标后的字符直到行尾
d0 删除光标前的字符直到行首
2dd 删除光标处的2行
4x 删除光标后的4个字符
```

#### 2.3、复制

Normal模式复制粘贴：

```vim
y/p       复制/粘贴
d/p       剪贴/粘贴

配合文本对象： 
yiw     复制一个单词
yy		复制单行
nyy		复制多行

vim里的剪贴(cut)/复制(copy)/粘贴(paste)分别是delete/yank/put
```

复制之后的粘贴，依然可以使用p键和P(大写)键

**Insert模式下的复制粘贴**：

```shell
使用鼠标进行行选中，然后使用Ctrl+v或者cmd+v粘贴
这个和其他的文本编辑器差不多，但是粘贴代码有个坑
很多人在vimrc中设置了autoindent，粘贴python代码缩进错乱
这个时候需要使用:set paste 和 :set nopaste解决
```

**vim的寄存器**

Vim里操作的是寄存器而不是系统剪贴板，这和其他编辑器不同

默认使用d删除或者y复制的内容都放在了"无名寄存器"

用x删除一个字符放到无名寄存器，然后p粘贴，可以调换俩字符

**深入寄存器(register)**

Vim不使用单一剪贴板进行剪贴、复制与粘贴，而是多组寄存器

- 通过"{register}"前缀可以指定寄存器，不指定默认用无名寄存器
- 比如使用 "ayiw 复制一个单词到寄存器a中，"bdd 删除当前行到寄存器b中
- 查看寄存器a中的内容 :reg a ，查看寄存器b中的内容 :reg b
- Vim中 "" 表示无名寄存器，缺省使用。"" p 其实就等同p 

**其他常见寄存器**

除了有名寄存器a-z，Vim中还有一些其他常见寄存器

- 复制专用寄存器 "0 使用y复制文本同时会被拷到复制寄存器0
- 系统剪贴板 "+ 可以在复制前加上 "+ 复制到系统剪贴板，验证是否支持系统剪贴板 :echo has('clipboard')、:set clipboard=unnamed可以直接复制粘贴系统前贴板内容
- 其他一些寄存器比如 "% 当前文件名，".上次插入的文本



#### 2.4、撤销

```shell
u		撤销
Ctrl+r	反撤销
```

"u" 键能一直撤销到文件打开时的状态，类似Windows下"Ctrl+z"键的作用。

"Ctrl+r"能一直反撤销到最后一次操作状态，类似Windows下"Ctrl+y"键的作用。

#### 2.5、修改

```vim
常用有三个 r (replace)、c (change)、s (substitute)
normal模式下使用 r 可以替换一个字符。s 替换并进入插入模式
使用 c 配合文本对象，可以快速进行修改

4s 删除光标后的4个字符并进入插入械
R 从光标所在处开始替换字符，按ESC结束
S/C 删除整行并进入插入模式
cw 删除一个单词，保留单词后的空白字符并进入插入模式
caw 删除整个单词包括后面的空白字符并进入插入模式
ct) 删除当前光标到右括号前的字符并进入插入模式
```

"r" 键替换单一字符，不用进入输入模式，实例使用时，比进入输入模式删除后再修改，要方便

#### 2.6、vim 配置文件

这是末行模式参数设置，多数需要在vim中才能生效

| 设置参数                           | 含义                                                         |
| :--------------------------------- | :----------------------------------------------------------- |
| :set nu<br />:set nonu             | 显示与取消行号                                               |
| :syntax on<br />:synatx off        | 是否依据语法显示相关的颜色帮助。在Vim中修改相关的配置文件或Shell脚本文件时(如脚本的/etc/init.d/sshd)，默认会显示相应的颜色 ，用来帮助排错。如果觉得颜色产生了干扰，则可以取消此设备 |
| :set hlsearch<br />:set nohlsearch | y设置是否将查找的字符串高亮显示，默认是set hlsearch高亮显示  |
| :set insearch                      | 增量搜索                                                     |
| :set ruler<br />:set noruler       | y设置是否显示右下角的状态栏，默认是set ruler显示             |
| :set showmode<br />:set noshowmode | y设置是否在左下角显示如"--INSERT--"之类的状态栏，默认是set showmode显示 |
| :set list<br />:set nolist         | y设置是否显示隐藏字符(Tab键用"^I"表示，回车符用"$"表示)。默认是nolist显示。如果使用set list显示隐藏字符，类似"cat -A 文件名" |
| :set ts=4                          | 设置Tab宽度为4个空格                                         |
| :set cul                           | 高亮当前行                                                   |

vim支持更多的设置参数，可以通过 ":set all" 进行查看

会发现，这些参数都只是临时生效，一旦关闭文件再打开，又需要重新输入。如果需要永久生效，需要手工建立vim的配置文件"~/.vimrc"，把需要的参数写入配置文件就永久生效了

补充：Windows下回车符在Linux中是用"^M$"符号显示，而不是"$"符。这样会导致Windows下编辑的程序脚本，无法在Linux中执行。这时可以通过使用"dos2unix"，把Windows格式转为Linux格式，当然反过来"unix2dos"命令就是把Linux格式转为Windows格式。这两个命令默认没有安装，需要手工安装才能使用。

```shell
" 常用设置
" 设置行号
set number
" 设置主题
colorscheme default
" 高亮搜索
set hlsearch
" 增量搜索
set insearch
" 搜索忽略大小写
set ignorecase
" 设置Tab宽度
set ts=4
" 统一缩进为4
set softtabstop=4
set shiftwidth=4
" 设置折叠方式
set foldmethod=indent
" 按F2进入粘贴模式
set pastetoggle=<F2>

" 一些方便的映射
let mapleader=','
" 使用 leader+w 直接保存(需要在编辑模式下,使用 ',+w' 可实现保存)
inoremap <leader>w <Esc>:w<cr>
" 需要在正常模式下，使用',+Shift+w'可实现保存
noremap <leader>W :w<cr>

" 使用 jj 进入 normal 模式
inoremap jj <Esc>

" 使用 Ctrl+h/j/k/l 切换窗口
noremap <C-h> <C-w>h
noremap <C-j> <C-w>j
noremap <C-k> <C-w>k
noremap <C-l> <C-w>l

"插入模式里删除
imap <C-h> " 向前删除一个字符（类似退格键）
imap <C-w> " 向前删除一个单词
imap <C-u> " 删除至行首
imap <C-k> " 删除至行尾

" 新建.sh,.py文件，自动插入文件头 
autocmd BufNewFile *.sh,*.py exec ":call SetTitle()"
" 定义函数SetTitle，自动插入文件头
func SetTitle()
	if &filetype == 'sh'
		call setline(1, "\#!/bin/bash")
		normal G
		normal o
		normal o
	elseif &filetype == 'python'
		call setline(1, "\#!/usr/bin/env python")
		call setline(2, "\# -*- coding:utf-8 -*-")
		normal G
		normal o
		normal o
		call setline(5, "if __name__ == '__main__':")
		call setline(6, "	pass")
	endif
endfunc
```

查看所有配置项 :help option-list

#### 2.7、搜索

```vim
/查找内容		从光标所在行向下查找
?查找内容		从光标所在行向上查找
n			   下一个
N			   上一个
*			   光标处单词高亮查找前向匹配	
#			   光标处单词高亮查找后向匹配 
```

#### 2.8、替换

```vim
r		替换光标所在处的字符
R		从光标所在处开始替换字符，按ESC结束
substitute 命令允许查找并且替换掉文本，并且支持表达式
格式 :[range]s[ubstitute]/{pattern}/{string}/[flags]
range 表示范围。比如 :10,20 表示10-20行，%表示全部
pattern是要替换的模式，string是替换后的文本
flags替换标志位，有几个常用的标志：
	g(global)表示全局范围内执行
	c(confirm)表示确认，可以确认或者拒绝修改
	n(number)报告匹配到次数而不替换，可以用来查询匹配次数

:1,10s/old/new/g	替换1到10行的所有old为new
:%s/old/new/g		替换整个文件的old为new
:s/old//n           统计old在文件中出现的次数不会替换
:1,10s/old//n       统计1-10行old在文件中出现的次数不会替换
:%s/\<old\>/new/g   完整匹配old替换，不包括oldd，hold这些
```

替换字符串，在shell中"#"开头是注释，注释文件的前10行：

```vim
:s/^/#/g		注释光标所在行
:s/^#//g		取消光标所在行注释
:1,10s/^/#/g	注释1到10行
:1,10/^#//g		取消注释
```

在C语言，PHP语言等大多数语言中，是使用"//"开头作为注释的，当然也可以用vim来写这些程序语言脚本，那么批量加入"//"注释：

```vim
:s/^/\/\//g		注释光标所在行
:s/^\/\///g		取消光标所在行注释
:1,10s/^/\/\//g 	注释1到10行
:1,10s/^\/\///g  取消注释
```

### 3、Visual(可视)模式

Visual模式一般用来块状选择文本

- Normal 模式下使用v进入visual选择
- 使用V选择行
- 使用Ctrl+v进行方块选择

| 命令                             | 描述                                                         |
| -------------------------------- | ------------------------------------------------------------ |
| v                                | 进入visual模式                                               |
| V                                | 进入行的visual模式                                           |
| Ctrl+v                           | 进入块操作模式用o和O改变选择的边的大小                       |
| 在所有行插入相同的内容如include< | 将光标移到开始插入的位置，按Ctrl+v进入visual模式，选择好模块后按I(Shift+i)，后插入要插入的文本，按ESC完成 |

### 4、快速切换insert和normal模式

很多键盘的键位设置，Esc按起来不方便，不方便切换换到normal

- 使用 Ctrl+c 代替Esc(但是可能会中断某些插件)或者 Ctrl+[
- gi 快速跳转到最后一次编辑的地方并进入插入模式

### 5、进入vim

| 命令                    | 描述                                            |
| ----------------------- | ----------------------------------------------- |
| vim filename            | 打开或新建文件，并将光标置于第一行行首          |
| vim +n filename         | 打开文件，并将光标置于第n行行首                 |
| vim + filename          | 打开文件，并将光标置于最后一行行首              |
| vim +/pattern filename  | 打开文件，并将光标置于第一个与pattern匹配的串处 |
| vim -r filename         | 在上次正用vim编辑时发生系统崩溃，恢复filename   |
| vim filename...filename | 打开多个文件，依次编辑                          |

### 6、移动光标

| 命令      | 描述                                     |
| --------- | ---------------------------------------- |
| k nk      | 上 向上移动n行                           |
| j nj      | 下 向下移动n行                           |
| h nh      | 左 向左移动n行                           |
| l nl      | 右 向右移动n行                           |
| Space     | 光标右移一个字符                         |
| Backspace | 光标左移一个字符                         |
| Enter     | 光标下移一行                             |
| w/W       | 光标右移一个字到字首                     |
| b/B       | 光标左移一个字到字首                     |
| e/E       | 光标右移一个字到字尾                     |
| )         | 光标移至句尾                             |
| (         | 光标移至句首                             |
| }         | 光标移至段落开头                         |
| {         | 光标移至段落结尾                         |
| n$        | 光标移至第n行尾                          |
| H         | 光标移至屏幕顶行                         |
| M         | 光标移至屏幕中间行                       |
| L         | 光标移至屏幕最后行                       |
| 0         | (注意是数字零)光标移至当前行首           |
| ^         | 移动光标到行首第一个非空字符上去         |
| $         | 光标移至当前行尾                         |
| gg        | 移到第一行                               |
| G         | 移到最后一行                             |
| f         | 移动光标到当前行的字符a上                |
| F         | 相反                                     |
| %         | 移动到与制匹配的括号上去()、{}、[]、<>等 |
| nG        | 移动到第n行首                            |
| n$        | 移动到第n行尾                            |

### 7、屏幕滚动

| 命令   | 描述                                               |
| ------ | -------------------------------------------------- |
| Ctrl+u | 向文件首翻半屏                                     |
| Ctrl+d | 向文件尾翻半屏                                     |
| Ctrl+f | 向文件尾翻一屏                                     |
| Ctrl+b | 向文件首翻一屏                                     |
| nz     | 将第n行滚至屏幕顶部，不指定n时将当前行滚至屏幕顶部 |

### 8、插入文本类

| 命令    | 描述                                                 |
| ------- | ---------------------------------------------------- |
| i       | 在光标前                                             |
| I       | 在当前行首                                           |
| a       | 在光标后                                             |
| A       | 在当前行尾                                           |
| o       | 在当前行之下新开一行                                 |
| O       | 在当前行之上新开一行                                 |
| r       | 替换当前字符                                         |
| R       | 替换当前字符及其后的字符，直到按ESC键                |
| s       | 从当前光标位置处开始，以输入的文件替代指定数目的字符 |
| S       | 删除指定数目的行，并以所输入文本代替之               |
| ncw/nCW | 修改指定数目                                         |
| nCC     | 修改指定数目的行                                     |

### 9、删除命令

| 命令      | 描述                                             |
| --------- | ------------------------------------------------ |
| x/X       | 删除一个字符，x删除光标后的，而X删除光标前的     |
| dw        | 删除一个单词(删除光标位置到下一个单词开始的位置) |
| dnw       | 删除n个单词                                      |
| dne       | 也可，只是删除到单词尾                           |
| do        | 删除至行首                                       |
| D/d$      | 删至行尾                                         |
| dG        | 删除当前位置后面的所有内容                       |
| dgg       | 删除当前位置前面的所有内容                       |
| dd        | 删除一行                                         |
| df"       | 删除到出现的第一个双引号                         |
| ndd       | 删除当前行及其后n-1行                            |
| dnl       | 向右删除n个字母                                  |
| dnh       | 向左删除n个字母                                  |
| dnj       | 向下删除n行，当前行+其上n行                      |
| dnk       | 向上删除n行，当前行+其下n行                      |
| cnw[word] | 将n个word改变为word                              |
| C$        | 改变到行尾                                       |
| cc        | 改变整行                                         |
| Shift+j   | 删除行尾的换行符，下一行接上来                   |

vim中的删除其实是剪切操作，删除的内容可以用p命令粘贴

### 10、复制粘贴

| 命令 | 描述                                             |
| ---- | ------------------------------------------------ |
| p    | 粘贴用x或d删除的文件，粘贴复制内容，当前行下一行 |
| P    | 粘贴复制内容，当前行下一行                       |
| 3p   | 将复制或剪切的内容粘贴三次                       |
| yw   | 复制光标开始的一个单词                           |
| ynw  | 复制n个单词                                      |
| yy   | 复制一行                                         |
| ynl  | 复制n个字符                                      |
| y$   | 复制当前光标到行尾处                             |
| nyy  | 向下复制n行                                      |
| yfB  | 复制光标到第一个大写B中间的内容                  |
| y2fB | 复制光标到第二个大写B中间的内容                  |

### 11、撤销

| 命令       | 描述                 |
| ---------- | -------------------- |
| u          | 撤销前一次的操作     |
| Shift+u(U) | 撤销对该行的所有操作 |
| Ctrl+r     | 反撤销               |

### 12、搜索及替换

| 命令                     | 描述                                                   |
| ------------------------ | ------------------------------------------------------ |
| /pattern                 | 从光标开始处向文件尾搜索pattern                        |
| ?                        | 从光标开始处向文件首搜索pattern                        |
| n                        | 在同一方向重复上一次搜索命令                           |
| N                        | 在反方向重复上一次搜索命令                             |
| 2n                       | 查找下面第二个匹配                                     |
| cw newword               | 替换为newword                                          |
| n                        | 继续查询                                               |
| .                        | 执行替换                                               |
| :s/p1/p2                 | 将p1替换为p2(只替换当前行第一处)                       |
| :s/p1/p2/g               | 将当前行中所有p1均用p2替代，g表示执行，用c表示需要确认 |
| :n1,n2 s/p1/p2/g         | 将第n1到n2行中所有p1均用p2替代                         |
| :g/p1/s//p2/g            | 将文件中所有p1均用p2替换                               |
| :%s/old/new/g            | 当前文件内进行替换                                     |
| :1,$ s/string1/string2/g | 在全文中将string1替换为string2                         |

### 13、书签

| 命令   | 描述                                  |
| ------ | ------------------------------------- |
| m[a-z] | 在文中做标记，标记号可为a-z的26个字母 |
| `a     | 移动到标记a处                         |

### 14、行方式命令

| 命令             | 描述                                              |
| ---------------- | ------------------------------------------------- |
| :n1,n2 co n3     | 将n1行到n2行之间的内容拷贝到第n3行下              |
| :n1,n2 m n3      | 将n1行到n2行之间的内容移至到第n3行下              |
| :n1,n2 d         | 将n1行到n2行之间的内容删除                        |
| :n1,n2 w!command | 将文件中n1行至n2行的内容作为command的输入并执行之 |

### 15、窗口操作

| 命令           | 描述                                     |
| -------------- | ---------------------------------------- |
| :split         | 分割一个窗口                             |
| :split file.c  | 为另一个文件file.c分割窗口               |
| :nsplit file.c | 为另一个文件file.c分割窗口，并指定其行数 |
| Ctrl+w         | 在窗口中切换                             |
| :close         | 关闭当前窗口                             |

### 16、文件及其他

| 命令                | 描述                                       |
| ------------------- | ------------------------------------------ |
| :q                  | 退出vi                                     |
| :q!                 | 不保存文件并退出vi                         |
| :qa!                | 有多个文件被打开，同时退出                 |
| :e filename         | 打开文件filename进行编辑                   |
| :e!                 | 放弃修改文件内容，重新载入该文件编辑       |
| :w                  | 保存当前文件                               |
| :wq                 | 保存并退出                                 |
| :x                  | 保存并退出                                 |
| :wqa                | 保存所有文件并退出                         |
| :ZZ                 | 保存当前文档并退出vim                      |
| :!command           | 执行shell命令command                       |
| :r!command          | 将命令command的输出结果放到当前行          |
| :n1,n2 write temp.c | 将第n1行到n2行的内容写入temp.c文件         |
| :read file.c        | 将文件file.c的内容插入到当前光标所在的下面 |

## 三、vim 使用技巧

### 1、在vim中导入其他文件内容或命令结果

#### 1.1、导入其他文件内容

```vim
：r 文件名		把文件名内容导入光标位置
```

可以把其他文件的内容导入到光标所在位置

#### 1.2、在vim中执行系统命令

```vim
:!命令	在vim中执行系统命令
```

这里只是在vim中执行系统命令，但并不把系统命令的结果写入到文件中。主要用于在文件编辑中，查看系统信息。如时间。

#### 1.3、导入命令结果

```vim
:r !命令		在vim中执行系统命令，并把命令结果导入到光标所在行
```

在vim中执行系统命令，并把命令结果导入光标所在行

### 2、设定快捷键

```vim
:map 快捷键 快捷键执行的命令		自定义快捷键
```

vim允许自定义快捷键，常用的自定义快捷键如下：

```vim
:map ^P I#<ESC>	按"Ctrl+p"时，在行首加入注释
:map ^B ^x	    按"Ctrl+b"时，删除行首第一个字母(删除注释)
```

注意：^p快捷键不能手工输入，需要执行Ctrl+V+P来定义，或Ctrl+V，然后Ctrl+P。 ^B快捷键也是一样。(前面的"^P ^B"，都需要按Ctrl+V、Ctrl+P出现^P，Ctrl+V、Ctrl+B出现^B 后面的快捷键执行的命令，直接输入)

### 3、字符替换

```vim
:ab 源字符	替换为字符		字符替换
```

在vim编辑中，有时候需要频繁输入某一个长字符串(比如邮箱)，这时使用字符串替换，能增加输入效率，例如：

```vim
:ab mymail zhicheng@163.com		当碰到"mymail"时，转变为邮箱
```

注意："源字符"不应设置的太短，否则可能影响输入

### 4、多文件打开

在vim中可以同时打开两个文件，只要执行如下命令：

```shell
# -o 小写o会上下分屏打开两个文件
[root@localhost ~]# vim -o abc bcd
# -O 大写O会左右分屏打开两个文件
[root@localhost ~]# vim -O abc bcd
```

这样可以同时打开两个文件，方便操作，如果是"-o"上下打开两个文件，可以通过先按"Ctrl+w"，再按"上下箭头"的方式在两个文件之间切换。

如果"-O"左中打开两个文件，可以通过先按"Ctrl+w"，再按"左右箭头"的方式在两个文件之间切换。

**Buffer**是指打开的一个文件内存缓冲区

缓冲区：

- Vim打开一个文件后会加载文件内容到缓冲区

- 之后的修改都针对内存中的缓冲区，并不会直接保存到文件

- 直到执行 :w(write)的时候才会把修改内容写入到文件里

buffer之间切换：

- 使用 :ls 会列举当前缓冲区，然后使用 :b n跳转到第n个缓冲区
- :bpre :bnext :bfirst :blast
- :b buffer_name 加上tab补全来跳转

```shell
[root@localhost ~]# ls
a.txt  b.txt c.txt
[root@localhost ~]# vim a.txt
# 使用vim打开a.txt后进入命令模式 e b.txt	
# 列举出当前缓冲区，进入命令模式 ls
```

**Window(窗口)**是Buffer可视化的分割区域：

- 一个缓冲区可以分割成多个窗口，每个窗口也可以打开不同缓冲区

- <Ctrl+w>s 水平分割，<Ctrl+w>v 垂直分割。或者 :sp 和 :vs

**切换窗口**：

切换窗口的命令都是使用Ctrl+w(window)作为前缀

| 命令          | 用途             |
| ------------- | ---------------- |
| Ctrl+w+w      | 在窗口间循环切换 |
| Ctrl+w+h      | 切换到左边的窗口 |
| Ctrl+w+j      | 切换到下边的窗口 |
| Ctrl+w+k      | 切换到上边的窗口 |
| Ctrl+w+l      | 切换到右边的窗口 |
| Ctrl+w+左箭头 | 切换到左边的窗口 |
| Ctrl+w+下箭头 | 切换到下边的窗口 |
| Ctrl+w+上箭头 | 切换到上边的窗口 |
| Ctrl+w+右箭头 | 切换到右边的窗口 |

**窗口移动**：

| 命令            | 用途             |
| --------------- | ---------------- |
| Ctrl+w，Shift+h | 把窗口的去到左边 |
| Ctrl+w，Shift+l | 把窗口的去到右边 |

**重排窗口**：

重排窗口可以改变窗口的大小 :h winodw-resize查看文档

| 命令               | 用途                      |
| ------------------ | ------------------------- |
| Ctrl+w+=           | 使用所有窗口等宽、等高    |
| Ctrl+w+_           | 最大化活动窗口的高度      |
| Ctrl+w+\|(竖杠)    | 最大货活动窗口的宽度      |
| [N]Ctrl+w+_        | 把活动窗口的高度设为[N]行 |
| [N]Ctrl+w+\|(竖杠) | 把活动窗口的宽度设为[N]列 |

**Tab(标签页)**可以组织窗口为一个工作区：

将窗口分组，是可以容纳一系列窗口的容器(:h tabpage)

- vim的Tab和其他编辑器不太一样，可以想象成Linux的虚拟桌面
- 比如一个Tab全用来编辑Python文件一个Tab全是HTML文件
- 相比窗口，Tab一般用的比较少，Tab太多管理起来比较麻烦

常用操作

| 命令                   | 用途                                 |
| ---------------------- | ------------------------------------ |
| :table[dit] {filename} | 在新标签页中打开{filename}           |
| Ctrl+w+T               | 把当前窗口移到一个新标签页           |
| :tabc[lose]            | 关闭当前标签页及其中的所有窗口       |
| :tabo[nly]             | 只保留活动标签页，关闭所有其他标签页 |

标签页切换操作

| Ex 命令        | 普通模式命令 | 用途                    |
| -------------- | ------------ | ----------------------- |
| :tabn[ext] {N} | {n}gt        | 切换到编号为{N}的标签页 |
| :tabn[ext]     | gt           | 切换到下一标签页        |
| :tabp[revious] | gT           | 切换到上一标签页        |

### 5、分屏

| 命令                 | 描述                                |
| -------------------- | ----------------------------------- |
| :vs                  | 水平分屏(左右)                      |
| :sp/:vsp             | 垂直分屏(上下)                      |
| Ctrl+ww              | 分屏之间切换                        |
| :qall                | 退出所有屏，以此类推有：wall，wqall |
| vim -o aa.txt bb.txt | 进入的时候就进行分屏(o水平，O垂直)  |

### 6、修改

```shell
常用有三个 r (replace)、c (change)、s (substitute)
normal模式下使用 r 可以替换一个字符。s 替换并进入插入模式
使用 c 配合文本对象，可以快速进行修改

4s 删除光标后的4个字符并进入插入械
R 连续替换光标的字符
S 删除整行并进入插入模式
C 删除整行并进入插入模式
caw 删除整个单词并进入插入模式
ct) 删除当前光标到右括号前的字符并进入插入模式
```

### 7、Text Object (文本对象)

vim里文本也有对象的概念，比如一个单词，一段句子，一个段落

很多其他编辑器经常只能操作单个字符来修改文本，比较低效

通过操作文本对象来修改要比只操作单个字符高效

**文本对象操作方式**：

```shell
dw 删除一个单词

[number]<command>[text object]
number 表示次数
command  是命令，d(elete)，c(hange)，y(yank)
text object 是要操作的文本对象，比如单词w，兔子s，段落p
```

iw表示inner word。如果输入viw命令，那么首先v进入选择模式，然后iw将选中当前单词

aw表示a word，它不旦会选中当前单词，还会包含当前单词之后的空格。

![](./images/QQ截图20190525125057.png)

![](./images/QQ截图20190525165623.png)

### 8、使用宏

宏的使用分为录制和回放

- Vim使用q来录制，同时也是q结束录制
- 使用q{register}选择要保存的寄存器，把录制的命令保存其中
- 使用@{register}回放寄存器中保存的一系列命令

例：把文件中的所有url都使用双引号引起来

第一种方式：

1. 使用normal模式下键入 qa

2. 回到第一行，键入Shift+i，输入双引号，Esc回到normal模式使用Shift+a，输入双引号，Esc回到normal模式，键入q

3. 移动到第二行，键入 Shift+v，Shift+g，进入命令模式 :'<,'>normal @a

第二种试：
1. normal模式下，第一行键入Shift+v，Shift+g，进入命令模式 :'<,'>normal I"
2. 再次进入命令模式 :'<,'>normal A"
   

### 9、补全

| 命令           | 实例类型         |
| -------------- | ---------------- |
| Ctrl+n         | 普通关键字       |
| Ctrl+x，Ctrl+n | 当前缓冲区关键字 |
| Ctrl+x，Ctrl+i | 包含文件关键字   |
| Ctrl+x，Ctrl+] | 标签文件关键字   |
| Ctrl+x，Ctrl+k | 字典查找         |
| Ctrl+x，Ctrl+l | 整行补全         |
| Ctrl+x，Ctrl+f | 文件名补全       |
| Ctrl+x，Ctrl+o | 全能(0mni)补全   |

常见的三种补全类型

1. 使用 Ctrl+n 和 Ctrl+p 补全单词
2. 使用 Ctrl+x Ctrl+f 补全文件名
3. 使用 Ctrl+x Ctrl+o 补全代码，需要开启文件类型检查，安装插件

```shell
:r! echo %	插入当前文件名
:r! echo %:p 插入当前文件完整路径
```
### 10、Vim更换配色
1. 使用 :colorscheme 显示当前的主题配色，默认是default
2. 用 :colorscheme Ctrl+d 可以显示所有的配色
3. 有中意的配色后，用 :colorscheme 配色名 就可以修改配色

### 11、大小写转换

| 命令    | 描述             |
| ------- | ---------------- |
| guw/gue | 光标后的单词大写 |
| gUw/gUe | 光标后的单词小写 |

### 12、键盘映射

不同模式下的键盘模式

| Command | Normal   | Visual     | Operator Pending | Insert Only | Command Line |
| ------- | -------- | ---------- | ---------------- | ----------- | ------------ |
| 命令    | 常规模式 | 可视化模式 | 运算符模式       | 插入模式    | 命令行模式   |
| :map    | y        | y          | y                |             |              |
| :nmap   | y        |            |                  |             |              |
| :vmap   |          | y          |                  |             |              |
| :omap   |          |            | y                |             |              |
| :map!   |          |            |                  | y           | y            |
| :imap   |          |            |                  | y           |              |
| :cmap   |          |            |                  |             | y            |

Normal Mode和Visual/Select Mode下，利用Tab键和Shift+Tab键来缩进文本：

```
nmap <tab> V>
nmap <s-tab> V<
vmap <tab> >gv
vmap <s-tab> <gv
```

查看键盘映射：

使用:map命令，可以列出所有键盘映射。其中第一列标明了映射在哪种模式下工作：

```
标记		模式
<space>  常规模式，可视化模式，运算符模式
n		 常规模式
v		 可视化模式	
o		 运算符模式
!		 插入模式，命令行模式
i		 插入模式
c		 命令模式
```

## 四、安装插件

### 1、安装emmet插件

```shell
# 在~/.vim手动创建plugin目录，这是将来存放插件的目录
[root@localhost ~]# cd ~/.vim
[root@localhost .vim]# mkdir plugin

# 创建bundle目录
[root@localhost .vim]# mdkir -p ~/.vim/bundle
# 进入.vim的bundle目录
[root@localhost .vim]# cd ~/.vim/bundle
# 下载插件
[root@localhost bundle]# git clone https://github.com/mattn/emmet-vim.git
# 进入下载好的目录
[root@localhost bundle]# cd emmet-vim
# 将下载好插件部分内容复制到vim的插件目录和自动加载目录
[root@localhost emmet-vim]# cp ~/.vim/bundle/emmet-vim/plugin/emmet.vim ~/.vim/plugin/
[root@localhost emmet-vim]# cp ~/.vim/bundle/emmet-vim/autoload/emmet.vim ~/.vim/autoload/
[root@localhost emmet-vim]# cp -a ~/.vim/bundle/emmet-vim/autoload/emmet ~/.vim/autoload/
# 在/etc/vimrc最末尾添加以下内容(设置使用ctrl+e 键来快速构建代码)
[root@localhost emmet-vim]# vim /etc/vimrc
let g:user_emmet_expandabbr_key = '<C-e>'
```

